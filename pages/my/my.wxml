<view class="container">
  <view class="profile">
    <button open-type="chooseAvatar" class="avatar-btn" bindchooseavatar="chooseAvatar">
      <image class="avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill" />
    </button>
    <input class="username" type="nickname" value="{{userInfo.nickName}}" bindchange="inputNickName" placeholder="请输入昵称" />
    <text class="city-count">已点亮 {{visitedCities.length}} 个城市</text>
  </view>

  <view class="map-switch">
    <view wx:for="{{maps}}" wx:key="index" class="map-item">
      <button bindtap="switchMap" data-index="{{index}}" class="map-btn {{currentMapIndex===index?'active':''}}">
        {{item.name}}
      </button>
      
      <view class="map-actions">
        <button class="action-btn rename-btn" bindtap="showRenameModal" data-index="{{index}}">
            ✍️
        </button>
        <button wx:if="{{maps.length > 1}}" class="action-btn delete-btn" bindtap="deleteMap" data-index="{{index}}">
            <text class="delete-icon">×</text>
        </button>
      </view>
    </view>
    <button class="map-btn create-btn" style="height: 96rpx;position: relative; top: 10px;" bindtap="showCreateModal">+ 新建</button>
  </view>

  <view class="section">
    <view class="map-description-container">
        <text class="map-description-text">{{currentDescription}}</text>
        <button class="map-description-edit" bindtap="showDescriptionModal">编辑</button>
    </view>
    <text class="section-title">我的足迹 - {{currentMapName}}</text>
    <view class="city-list">
      <block wx:for="{{visitedCities}}" wx:key="index">
        <view class="city-item" bindtap="showCityDetail" data-city="{{item}}">
          <text class="city-name">{{item.name}}</text>
          <!-- <text class="city-time">{{item.date || item.datetime}}</text>x -->
        </view>
      </block>
      <view wx:if="{{visitedCities.length === 0}}" class="empty-tip">还没有点亮任何城市哦～ <span class="empty-tip go_light" bind:tap="goListPage">去点亮</span></view>
    </view>
  </view>

  <!-- <view class="logout-section">
    <button class="logout-button" bindtap="logout">退出登录</button>
  </view> -->

  <view wx:if="{{showDetailModal}}" class="popup-mask" bindtap="closePopup">
    <view class="popup" catchtap="stopTap">
      <text class="popup-title">{{currentCity.name}}</text>

      <view class="popup-field">
        <text class="label">点亮时间：</text>
        <text class="value">{{currentCity.date || currentCity.datetime}}</text>
      </view>

      <view class="popup-field remark">
        <text class="label">{{currentCity.note}}</text>
      </view>
    </view>
  </view>

  <view wx:if="{{showCreateModal}}" class="popup-mask" bindtap="closeCreateModal">
    <view class="popup" catchtap="stopTap">
      <text class="popup-title">创建新足迹</text>
      
      <view class="popup-field">
        <text class="label">足迹名称：</text>
        <input class="create-input" value="{{newMapName}}" placeholder="请输入足迹名称" bindinput="onNewMapNameInput" maxlength="10" />
      </view>

      <view class="popup-buttons">
        <button class="popup-cancel" bindtap="closeCreateModal">取消</button>
        <button class="popup-save" bindtap="confirmCreateMap">创建</button>
      </view>
    </view>
  </view>

  <view wx:if="{{showRenameModal}}" class="popup-mask" bindtap="closeRenameModal">
    <view class="popup" catchtap="stopTap">
      <text class="popup-title">重命名足迹</text>
      
      <view class="popup-field">
        <text class="label">名称：</text>
        <input class="rename-input" value="{{renameText}}" placeholder="请输入新名称" bindinput="onRenameInput" maxlength="10" />
      </view>

      <view class="popup-buttons">
        <button class="popup-cancel" bindtap="closeRenameModal">取消</button>
        <button class="popup-save" bindtap="confirmRename">保存</button>
      </view>
    </view>
  </view>
  
  <view wx:if="{{showDescriptionModal}}" class="popup-mask" bindtap="closeDescriptionModal">
    <view class="popup" catchtap="stopTap">
      <text class="popup-title">编辑足迹说明</text>
      
      <view class="popup-field description-input-field">
        <textarea 
          class="description-textarea" 
          placeholder="请输入足迹说明文案" 
          value="{{descriptionInput}}" 
          bindinput="onDescriptionInput" 
          maxlength="200" 
          auto-height
        />
      </view>

      <view class="popup-buttons">
        <button class="popup-cancel" bindtap="closeDescriptionModal">取消</button>
        <button class="popup-save" bindtap="confirmUpdateDescription">保存</button>
      </view>
    </view>
  </view>
</view>